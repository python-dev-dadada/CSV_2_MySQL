<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Bootstrap Example</title>
        <meta charset="utf-8" />
        <title>
            CSV to MySQL
        </title>
        <meta name="description" content="Bootstrap touchspin examples">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!--begin::Web font -->
        <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
        <script>
            WebFont.load({
                google: {"families":["Poppins:300,400,500,600,700","Roboto:300,400,500,600,700"]},
                active: function() {
                    sessionStorage.fonts = true;
                }
            });
        </script>
        <!--end::Web font -->
        <!--begin::Base Styles -->
        <link href="assets/vendors/base/vendors.bundle.css" rel="stylesheet" type="text/css" />
        <link href="assets/demo/default/base/style.bundle.css" rel="stylesheet" type="text/css" />
        <!--end::Base Styles -->
        <link rel="shortcut icon" href="assets/demo/default/media/img/logo/favicon.ico" />
        <style>
            div {
                margin: 0px
            }
            div.container_ {
                margin: 20px 50px;
            }
            div.row {
                margin: 15px 0px;
            }
            div.my_container_outer {
                padding: 0 10px
            }
            div.my_container {
                border: solid 2px #cccccc;
            }
            a.up_down {
                color: black;
            }
            a.up_down:hover {
                text-decoration: none;
            }
        </style>
    </head>

    <body style="background-color:#fafffa;">
        <div class="jumbotron text-center" style="height: 30px;">
            <h1>CSV To MySQL</h1>
        </div>
        
        <div class="container_">
            <form action="func.php?r=upload" id="my_form" name="my_form" method="post" enctype="multipart/form-data">
                <input type="hidden" id="field_list" name="field_list">
                <div class="row">
                    <div class="col-lg-12 my_container_outer">
                        <div class="col-lg-12 my_container">
                            <div class="col-lg-12 form-group m-form__group row">
                                <div class="col-lg-1">
                                    Filename :
                                </div>
                                <div class="col-lg-11">
                                    <input type="file" id="f_name" name="f_name" class="form-control-file">
                                </div>
                            </div>
                            <div class="col-lg-12 form-group m-form__group row">
                                <div class="col-lg-1">
                                    Encoding :
                                </div>
                                <div class="col-lg-5">
                                    <select class="custom-select " id="charset_list" name="charset_list">
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            


            <div class="col-lg-12 form-group m-form__group row" style="padding: 0px">
                <div class="col-lg-6 my_container_outer" style="margin: 0px;">
                    <div class="col-lg-12 my_container" style="height: 100%;">
                        <div class="col-lg-12 form-group m-form__group row" style="height: 65%;">                    
                            <label class="col-form-label col-lg-2">
                                Ignore first :
                            </label>
                            <div class="col-lg-2">
                                <input id="m_touchspin_5" name="m_touchspin_5" type="text" class="form-control bootstrap-touchspin-vertical-btn" value="0" name="demo1" type="text">
                            </div>
                            <label class="col-form-label col-lg-1">
                                lines
                            </label>
                        </div> 
                        <div class="col-lg-12 form-group m-form__group row">                    
                            <label class="m-checkbox">
                                <input type="checkbox" checked="checked" id="trunc" name="trunc">
                                Truncate destination table before import
                                <span></span>
                            </label>
                        </div>                   
                    </div>
                </div>

                
                <div class="col-lg-6 my_container_outer" style="margin: 0px;">
                    <div class="col-lg-12 my_container">
                        <div class="col-lg-12 form-group m-form__group row">                    
                            <label class="col-form-label col-lg-3">
                                Fields terminated by 
                            </label>
                            <div class="col-lg-4">
                                <input class="form-control m-input" type="text" value="," id="f_term" name="f_term">
                            </div>
                        </div>
                        
                        <div class="col-lg-12 form-group m-form__group row">                    
                            <label class="col-form-label col-lg-3">
                                Fields enclosed by 
                            </label>
                            <div class="col-lg-4">
                                <input class="form-control m-input" type="text" value='"' id="f_enc" name="f_enc">
                            </div>
                            <div class="col-lg-3 m-checkbox-list">
                                <label class="m-checkbox">
                                    <input type="checkbox" checked="checked" id="opt" name="opt">
                                    optionally
                                    <span></span>
                                </label>
                            </div>
                        </div>

                        <div class="col-lg-12 form-group m-form__group row">                    
                            <label class="col-form-label col-lg-3">
                                Fields escaped by 
                            </label>
                            <div class="col-lg-4">
                                <input class="form-control m-input" type="text" value='\\' id="f_esc" name="f_esc">
                            </div>
                        </div>

                        <div class="col-lg-12 form-group m-form__group row">                    
                            <label class="col-form-label col-lg-3">
                                Lines terminated by 
                            </label>
                            <div class="col-lg-4">
                                <input class="form-control m-input" type="text" value="\r\n" id="l_term" name="l_term">
                            </div>
                        </div>
                    </div>
                
                </div>
            </div>


            <div class="col-lg-12 form-group m-form__group row" style="padding: 0px">
                <div class="col-lg-6 my_container_outer" style="margin: 0px;">
                    <div class="col-lg-12 my_container" style="height: 100%;">
                        <div class="col-lg-12 form-group m-form__group row">                    
                            <div class="m-radio-list">
                                <label class="m-radio">
                                    <input type="radio" name="opt_ins" value="">
                                    INSERT (may throw errors)
                                    <span></span>
                                </label>
                                <label class="m-radio">
                                    <input type="radio" name="opt_ins" value="IGNORE" checked="checked">
                                    INSERT IGNORE (duplicates)
                                    <span></span>
                                </label>
                                <label class="m-radio">
                                    <input type="radio" name="opt_ins" value="REPLACE">
                                    REPLACE (may throw errors)
                                    <span></span>
                                </label>
                            </div>
                        </div>                    
                    </div>                    
                </div>

                
                <div class="col-lg-6 my_container_outer" style="margin: 0px;">
                    <div class="col-lg-12 my_container">
                        <div class="col-lg-12 form-group m-form__group row">                    
                            <label class="col-form-label col-lg-2">
                                Database: 
                            </label>
                            <div class="col-lg-10">
                                <select class="custom-select " id="db_list" name="db_list">
                                </select>
                            </div>
                        </div>

                        <div class="col-lg-12 form-group m-form__group row">                    
                            <label class="col-form-label col-lg-2">
                                Tables: 
                            </label>
                            <div class="col-lg-10">
                                <select class="custom-select " id="tbl_list" name="tbl_list">                                    
                                </select>
                            </div>
                        </div>
                        
                        <div class="col-lg-12 form-group m-form__group row">
                            <div class="m-demo-icon__preview col-lg-2">
                                <label class="col-form-label">
                                    Columns: 
                                </label>
                                <p></p>
                                <div class="m-demo-icon__preview">
                                    <a href="#" class="up_down" id="to_up" name="to_up">
                                        <i class="fa fa-caret-up"></i> Up
                                    </a>                                    
                                </div>
                                <p></p>
                                <div class="m-demo-icon__preview">
                                    <a href="#" class="up_down" id="to_down" name="to_down">
                                        <i class="fa fa-caret-down"></i> Down
                                    </a>
                                    
                                </div>
                                <p></p>
                                <div class="m-checkbox-list">
                                    <label class="m-checkbox">
                                        <input type="checkbox" id="ch_all" name="ch_all">
                                        All
                                        <span></span>
                                    </label>
                                </div>
                            </div>   

                            <div class="col-lg-10">
                                <div class="list-group checkbox-list-group" id="col_list" name="col_list">
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                
                </div>
            </div>

            <div style="float: right;">
                <button type="button" class="btn btn-primary" id="btn_import" name="btn_import" style="margin-right: 20px;">
                    Import
                </button>
                <button type="button" class="btn btn-secondary">
                    Cancel
                </button>
            </div>            

            </form>
        </div>

        <script src="https://code.jquery.com/jquery-3.5.1.min.js" type="text/javascript"></script>
        <script>
            $(document).ready(function(){
                $.ajax({
                    url: "http://localhost/csv/func.php?r=get_db_list",
                    type: "GET",
                    datatype: "text",        
                    success: function (result) { 
                        console.log("success");
                        $("#db_list").html(result);
                        get_tbl_list();
                    },
                    error: function (error) {
                        
                    }       
                });

                $.ajax({
                    url: "http://localhost/csv/func.php?r=get_charset_list",
                    type: "GET",
                    datatype: "text",        
                    success: function (result) { 
                        console.log("success");
                        $("#charset_list").html(result);
                    },
                    error: function (error) {
                        
                    }       
                });

                function get_tbl_list() {
                    $.ajax({
                        url: "http://localhost/csv/func.php?r=get_tbl_list&db=" + $("#db_list").val(),
                        type: "GET",
                        datatype: "text",        
                        success: function (result) { 
                            console.log("success");
                            $("#tbl_list").html(result);
                            get_col_list();
                        },
                        error: function (error) {
                            
                        }       
                    });
                } 

                function get_col_list() {
                    $.ajax({
                        url: "http://localhost/csv/func.php?r=get_col_list&db=" + $("#db_list").val() + "&tbl=" + $("#tbl_list").val(),
                        type: "GET",
                        datatype: "text",        
                        success: function (result) { 
                            console.log("success");
                            $("#col_list").html(result);
                        },
                        error: function (error) {
                            
                        }       
                    });
                } 

                $("#db_list").change(function(){
                    get_tbl_list();
                });

                $("#tbl_list").change(function(){
                    get_col_list();
                });

                $("#to_up").click(function() {
                    var cols = $("#col_list").children("div")
                    for(var i = 1; i < $(cols).length; i++) {
                        if ($(cols[i]).children("label:first").children("input:first").prop("checked")) {
                            var tt = $(cols[i]).children("label:first").children("span:first").text();
                            $(cols[i]).children("label:first").children("span:first").text(" "+$(cols[i-1]).children("label:first").children("span:first").text());
                            $(cols[i-1]).children("label:first").children("span:first").text(" " + tt);
                            
                            $(cols[i]).children("label:first").children("input:first").prop("checked", $(cols[i-1]).children("label:first").children("input:first").prop("checked"))
                            $(cols[i-1]).children("label:first").children("input:first").prop("checked", true)
                            
                            break;
                        }
                    }
                });

                $("#to_down").click(function() {
                    var cols = $("#col_list").children("div")
                    for(var i = 0; i < $(cols).length - 1; i++) {
                        if ($(cols[i]).children("label:first").children("input:first").prop("checked")) {
                            var tt = $(cols[i]).children("label:first").children("span:first").text();
                            $(cols[i]).children("label:first").children("span:first").text(" "+$(cols[i+1]).children("label:first").children("span:first").text());
                            $(cols[i+1]).children("label:first").children("span:first").text(" " + tt);
                            
                            $(cols[i]).children("label:first").children("input:first").prop("checked", $(cols[i+1]).children("label:first").children("input:first").prop("checked"))
                            $(cols[i+1]).children("label:first").children("input:first").prop("checked", true)
                            
                            break;
                        }
                    }
                });

                $("#btn_import").click(function() {                    
                    // console.log("f_term = " + $("#f_term").val());
                    // console.log("f_enc = " + $("#f_enc").val());
                    // console.log("opt = " + $("#opt").is(":checked"));
                    // console.log("f_esc = " + $("#f_esc").val());
                    // console.log("l_term = " + $("#l_term").val());
                    // console.log("ign = " + $("#m_touchspin_5").val());
                    // console.log("trunc = " + $("#trunc").is(":checked"));
                    // console.log("opt_ins = " + $("input[name='opt_ins']:checked").val());
                    // console.log("db = " + $("#db_list").val());
                    // console.log("tbl = " + $("#tbl_list").val());
                    // console.log("encoding = " + $("#charset_list").val());
                    c_list = [];
                    var cols = $("#col_list").children("div")
                    for(var i = 0; i < $(cols).length; i++) {
                        if ($(cols[i]).children("label:first").children("input:first").prop("checked")) {
                            c_list.push($(cols[i]).children("label:first").children("span:first").text().trim());
                        }
                    }
                    $("#field_list").val(c_list.join("#"));
                    // console.log("col_list = " + c_list.join("#"))

                    // $.ajax({
                    //     url: "http://localhost/csv/func.php?r=import",
                    //     type: "POST",
                    //     data: { f_term: $("#f_term").val(), f_enc: $("#f_enc").val(), opt: $("#opt").is(":checked"), f_esc: $("#f_esc").val(), l_term: $("#l_term").val(), 
                    //             ign: $("#m_touchspin_5").val(), trunc: $("#trunc").is(":checked"), opt_ins: $("input[name='opt_ins']:checked").val(), db: $("#db_list").val(), 
                    //             tbl: $("#tbl_list").val(), col_list: c_list.join("#"), encoding: $("#charset_list").val(), f_name: $("#f_name").val() },       
                    //     success: function (result) { 
                    //         console.log(result);                        
                    //     },
                    //     error: function (error) {
                            
                    //     }       
                    // });
                    document.forms[0].submit();
                });

                $("#ch_all").click(function() {
                    var cols = $("#col_list").children("div")
                    for(var i = 0; i < $(cols).length; i++) {
                        $(cols[i]).children("label:first").children("input:first").prop("checked", $("#ch_all").prop("checked"));
                    }
                });
            });

        </script>
        <script src="assets/vendors/base/vendors.bundle.js" type="text/javascript"></script>
        <script src="assets/demo/default/base/scripts.bundle.js" type="text/javascript"></script>
        <script src="assets/demo/default/custom/components/forms/widgets/bootstrap-touchspin.js" type="text/javascript"></script>
        
    </body>
</html>
